{# Header Component - مكون الرأس #}
<header class="site-header" role="banner">
    {# Announcement Bar #}
    {% if theme.settings.get('show_announcement_bar') %}
    <div class="announcement-bar" role="status">
        <div class="container">
            <div class="announcement-content">
                <p class="announcement-text">{{ theme.settings.get('announcement_text') }}</p>
                <button class="close-announcement" aria-label="إغلاق الإعلان" onclick="this.parentElement.parentElement.style.display='none'">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
    {% endif %}
    
    {# Main Navigation Bar #}
    <nav class="navbar" role="navigation" aria-label="الملاحة الرئيسية">
        <div class="container navbar-container">
            {# Logo #}
            <div class="navbar-brand">
                <a href="/" class="logo" aria-label="{{ store.name }}">
                    {% if store.logo_url %}
                        <img src="{{ store.logo_url }}" alt="{{ store.name }}" class="logo-img">
                    {% else %}
                        <span class="logo-text">{{ store.name }}</span>
                    {% endif %}
                </a>
            </div>

            {# Mobile Menu Toggle #}
            <button class="mobile-menu-toggle" data-mobile-menu-toggle aria-expanded="false" aria-controls="mobile-menu" aria-label="{{ 'header.menu' | t }}">
                <span class="toggle-line"></span>
                <span class="toggle-line"></span>
                <span class="toggle-line"></span>
            </button>

            {# Main Menu #}
            <ul class="navbar-menu" role="menubar">
                <li role="menuitem">
                    <a href="/" class="nav-link">{{ 'header.home' | t }}</a>
                </li>
                <li role="menuitem">
                    <a href="/products" class="nav-link">{{ 'header.products' | t }}</a>
                </li>
                {% for category in categories %}
                <li role="menuitem">
                    <a href="{{ category.url }}" class="nav-link">{{ category.name }}</a>
                </li>
                {% endfor %}
                <li role="menuitem">
                    <a href="/contact" class="nav-link">{{ 'header.contact' | t }}</a>
                </li>
            </ul>
            
            {# Right Actions #}
            <div class="navbar-actions">
                {# Search #}
                <form class="search-form" role="search" method="get" action="/search" data-search-form>
                    <label for="search-input" class="sr-only">{{ 'common.search' | t }}</label>
                    <input
                        type="search"
                        id="search-input"
                        class="search-input"
                        placeholder="{{ 'common.search' | t }}"
                        name="q"
                        aria-label="{{ 'common.search' | t }}"
                        data-search-input
                    >
                    <button type="submit" class="search-btn" aria-label="بحث">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
                            <circle cx="8" cy="8" r="6"></circle>
                            <path d="M12 12l4 4"></path>
                        </svg>
                    </button>
                </form>
                
                {# Account Dropdown #}
                <div class="account-dropdown">
                    <button class="account-btn" aria-label="{{ 'common.account' | t }}">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        {% if customer %}
                            <li role="menuitem"><a href="/customer/profile">{{ 'common.account' | t }}</a></li>
                            <li role="menuitem"><a href="/customer/orders">الطلبات</a></li>
                            <li role="menuitem"><a href="/customer/wishlist">قائمة الرغبات</a></li>
                            <li role="menuitem"><a href="/logout">{{ 'common.logout' | t }}</a></li>
                        {% else %}
                            <li role="menuitem"><a href="/login">{{ 'common.login' | t }}</a></li>
                            <li role="menuitem"><a href="/register">{{ 'common.register' | t }}</a></li>
                        {% endif %}
                    </ul>
                </div>
                
                {# Cart Button #}
                <a href="/cart" class="cart-btn" aria-label="{{ 'common.cart' | t }}">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1h7.586a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM15 16a2 2 0 11-4 0 2 2 0 014 0zm-8 0a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    {% if cart.items_count > 0 %}
                    <span class="cart-count" aria-label="عدد العناصر: {{ cart.items_count }}">{{ cart.items_count }}</span>
                    {% endif %}
                </a>
            </div>
        </div>
        {# Mobile Menu Drawer #}
        <div class="mobile-menu" id="mobile-menu" data-mobile-menu>
            <div class="mobile-menu-inner">
                <form class="mobile-search" role="search" method="get" action="/search" data-search-form>
                    <label for="mobile-search-input" class="sr-only">{{ 'common.search' | t }}</label>
                    <input id="mobile-search-input" name="q" class="mobile-search-input" type="search" placeholder="{{ 'common.search' | t }}" data-search-input>
                    <button type="submit" class="mobile-search-btn" aria-label="{{ 'common.search' | t }}">بحث</button>
                </form>
                <ul class="mobile-menu-list" role="menubar">
                    <li role="menuitem"><a href="/" class="mobile-link">{{ 'header.home' | t }}</a></li>
                    <li role="menuitem"><a href="/products" class="mobile-link">{{ 'header.products' | t }}</a></li>
                    {% for category in categories %}
                        <li role="menuitem"><a href="{{ category.url }}" class="mobile-link">{{ category.name }}</a></li>
                    {% endfor %}
                    <li role="menuitem"><a href="/contact" class="mobile-link">{{ 'header.contact' | t }}</a></li>
                </ul>
                <div class="mobile-actions">
                    {% if customer %}
                        <a class="mobile-link" href="/customer/profile">{{ 'common.account' | t }}</a>
                        <a class="mobile-link" href="/customer/orders">{{ 'header.orders' | default('الطلبات') }}</a>
                        <a class="mobile-link" href="/customer/wishlist">{{ 'wishlist.title' | default('قائمة الرغبات') }}</a>
                        <a class="mobile-link" href="/logout">{{ 'common.logout' | t }}</a>
                    {% else %}
                        <a class="mobile-link" href="/login">{{ 'common.login' | t }}</a>
                        <a class="mobile-link" href="/register">{{ 'common.register' | t }}</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>
</header>

<style>
    .site-header {
        position: sticky;
        top: 0;
        z-index: 100;
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .announcement-bar {
        background: var(--primary-color);
        color: white;
        padding: 12px 0;
        font-size: 14px;
        line-height: 1.5;
    }
    
    .announcement-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .announcement-text {
        margin: 0;
        flex: 1;
    }
    
    .close-announcement {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        padding: 0 8px;
        display: flex;
        align-items: center;
    }
    
    .navbar {
        background: white;
        padding: 16px 0;
    }
    
    .navbar-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 24px;
    }
    
    .navbar-brand {
        flex-shrink: 0;
    }
    
    .logo {
        display: flex;
        align-items: center;
        text-decoration: none;
        color: var(--primary-color);
        font-size: 20px;
        font-weight: 700;
    }
    
    .logo-img {
        height: 40px;
        width: auto;
    }
    
    .navbar-menu {
        display: flex;
        list-style: none;
        margin: 0;
        padding: 0;
        gap: 32px;
        flex: 1;
    }
    
    .nav-link {
        color: var(--text-dark);
        text-decoration: none;
        font-weight: 500;
        transition: color var(--transition);
    }
    
    .nav-link:hover,
    .nav-link:focus {
        color: var(--accent-color);
        outline: none;
    }
    
    .navbar-actions {
        display: flex;
        align-items: center;
        gap: 16px;
    }
    
    .search-form {
        position: relative;
        width: 200px;
    }
    
    .search-input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #E5E7EB;
        border-radius: 4px;
        font-size: 14px;
    }
    
    .search-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: var(--text-light);
    }
    
    .account-dropdown {
        position: relative;
    }
    
    .account-btn,
    .cart-btn {
        background: none;
        border: none;
        cursor: pointer;
        color: var(--text-dark);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        padding: 8px;
        transition: color var(--transition);
    }
    
    .account-btn:hover,
    .cart-btn:hover,
    .account-btn:focus,
    .cart-btn:focus {
        color: var(--accent-color);
        outline: none;
    }
    
    .cart-count {
        position: absolute;
        top: -8px;
        right: -8px;
        background: var(--accent-color);
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
    }
    
    .dropdown-menu {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border: 1px solid #E5E7EB;
        border-radius: 4px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        list-style: none;
        margin: 8px 0 0 0;
        padding: 8px 0;
        min-width: 200px;
        z-index: 200;
    }
    
    .account-dropdown:hover .dropdown-menu {
        display: block;
    }
    
    .dropdown-menu li a {
        display: block;
        padding: 12px 16px;
        color: var(--text-dark);
        text-decoration: none;
        transition: background-color var(--transition);
    }
    
    .dropdown-menu li a:hover {
        background-color: var(--secondary-color);
        color: var(--accent-color);
    }

    .mobile-menu-toggle {
        display: none;
        flex-direction: column;
        gap: 4px;
        background: none;
        border: 1px solid #E5E7EB;
        border-radius: 8px;
        padding: 8px;
        cursor: pointer;
    }

    .toggle-line {
        width: 22px;
        height: 2px;
        background: var(--text-dark);
    }

    .mobile-menu {
        display: none;
        background: white;
        border-top: 1px solid #E5E7EB;
        box-shadow: 0 10px 20px rgba(0,0,0,0.08);
    }

    .mobile-menu.active { display: block; }

    .mobile-menu-inner { padding: 16px; display: flex; flex-direction: column; gap: 16px; }

    .mobile-menu-list { list-style: none; margin: 0; padding: 0; display: flex; flex-direction: column; gap: 12px; }

    .mobile-link { color: var(--text-dark); text-decoration: none; font-weight: 600; }

    .mobile-search { display: flex; gap: 8px; }

    .mobile-search-input { flex: 1; padding: 10px 12px; border: 1px solid #E5E7EB; border-radius: 6px; }

    .mobile-search-btn { padding: 10px 16px; background: var(--accent-color); color: white; border: none; border-radius: 6px; cursor: pointer; }

    .mobile-actions { display: flex; flex-direction: column; gap: 8px; border-top: 1px solid #E5E7EB; padding-top: 12px; }

    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
    }

    @media (max-width: 768px) {
        .navbar-menu { display: none; }
        .search-form { display: none; }
        .mobile-menu-toggle { display: inline-flex; }
    }
</style>
