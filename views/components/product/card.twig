{# Product Card Component - بطاقة المنتج #}
{# Usage: {% include 'components/product/card' with {'product': product} %} #}

<div class="product-card">
    {# Product Image #}
    <div class="product-image">
        {% if product.image %}
            <img 
                src="{{ product.image }}" 
                alt="{{ product.name }}" 
                class="card-img"
                loading="lazy"
            >
        {% else %}
            <img 
                src="{{ theme.settings.get('placeholder') | asset_url }}" 
                alt="صورة غير متاحة" 
                class="card-img"
            >
        {% endif %}
        
        {# Stock Badge #}
        <div class="product-badge">
            {% if product.quantity > 0 %}
                <span class="badge badge-in-stock">{{ 'products.in_stock' | t }}</span>
            {% else %}
                <span class="badge badge-out-stock">{{ 'products.out_of_stock' | t }}</span>
            {% endif %}
        </div>
        
        {# Wishlist Button #}
        {% if theme.settings.get('enable_wishlist') %}
        <button class="wishlist-btn" aria-label="إضافة إلى المفضلة" title="إضافة إلى المفضلة" data-wishlist-toggle data-product-id="{{ product.id }}">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
        </button>
        {% endif %}
    </div>
    
    {# Product Info #}
    <div class="product-info">
        {# Category #}
        {% if product.category %}
        <p class="product-category">{{ product.category }}</p>
        {% endif %}
        
        {# Product Name #}
        <h3 class="product-name">
            <a href="{{ product.url }}" class="product-link">{{ product.name }}</a>
        </h3>
        
        {# Rating #}
        {% if product.rating %}
        <div class="product-rating" aria-label="تقييم: {{ product.rating }} من 5">
            <div class="stars">
                {% for i in range(1, 6) %}
                    {% if i <= product.rating %}
                        <span class="star star-filled">★</span>
                    {% else %}
                        <span class="star">★</span>
                    {% endif %}
                {% endfor %}
            </div>
            {% if product.review_count %}
            <span class="review-count">({{ product.review_count }})</span>
            {% endif %}
        </div>
        {% endif %}
        
        {# Price #}
        <div class="product-price">
            {% if product.sale_price %}
                <span class="original-price">{{ product.price | price }}</span>
                <span class="sale-price">{{ product.sale_price | price }}</span>
            {% else %}
                <span class="price">{{ product.price | price }}</span>
            {% endif %}
        </div>
        
        {# Description (optional) #}
        {% if product.description %}
        <p class="product-description">{{ product.description | truncate(100) }}</p>
        {% endif %}
    </div>
    
    {# Product Actions #}
    <div class="product-actions">
        {% if product.quantity > 0 %}
            <button class="btn btn-add-cart" data-add-to-cart data-product-id="{{ product.id }}" data-quantity="1">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1h7.586a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM15 16a2 2 0 11-4 0 2 2 0 014 0zm-8 0a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                {{ 'products.add_to_cart' | t }}
            </button>
        {% else %}
            <button class="btn btn-disabled" disabled>
                {{ 'products.out_of_stock' | t }}
            </button>
        {% endif %}
        
        <a href="{{ product.url }}" class="btn btn-outline">عرض التفاصيل</a>
    </div>
</div>

<style>
    .product-card {
        display: flex;
        flex-direction: column;
        height: 100%;
        background: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        transition: all var(--transition);
        border: 1px solid #E5E7EB;
    }
    
    .product-card:hover {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        transform: translateY(-4px);
    }
    
    .product-image {
        position: relative;
        overflow: hidden;
        aspect-ratio: 1;
        background: var(--secondary-color);
    }
    
    .card-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .product-card:hover .card-img {
        transform: scale(1.05);
    }
    
    .product-badge {
        position: absolute;
        top: 12px;
        right: 12px;
    }
    
    .badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .badge-in-stock {
        background: #D1FAE5;
        color: #065F46;
    }
    
    .badge-out-stock {
        background: #FEE2E2;
        color: #7F1D1D;
    }
    
    .wishlist-btn {
        position: absolute;
        top: 12px;
        left: 12px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: white;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-dark);
        transition: all var(--transition);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .wishlist-btn:hover,
    .wishlist-btn:focus {
        color: var(--accent-color);
        outline: none;
    }
    
    .product-info {
        padding: 16px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    .product-category {
        margin: 0 0 8px 0;
        font-size: 12px;
        color: var(--text-light);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .product-name {
        margin: 0 0 12px 0;
        font-size: 16px;
        font-weight: 600;
        line-height: 1.4;
        min-height: 2.8em;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .product-link {
        color: var(--text-dark);
        text-decoration: none;
        transition: color var(--transition);
    }
    
    .product-link:hover,
    .product-link:focus {
        color: var(--accent-color);
        outline: none;
    }
    
    .product-rating {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 12px;
    }
    
    .stars {
        display: flex;
        gap: 2px;
    }
    
    .star {
        color: #E5E7EB;
        font-size: 14px;
    }
    
    .star-filled {
        color: #FCD34D;
    }
    
    .review-count {
        font-size: 12px;
        color: var(--text-light);
    }
    
    .product-price {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 12px 0;
        flex-wrap: wrap;
    }
    
    .price,
    .sale-price {
        font-size: 18px;
        font-weight: 700;
        color: var(--primary-color);
    }
    
    .original-price {
        font-size: 14px;
        color: var(--text-light);
        text-decoration: line-through;
    }
    
    .sale-price {
        color: #DC2626;
    }
    
    .product-description {
        font-size: 13px;
        color: var(--text-light);
        margin: 8px 0 0 0;
        flex: 1;
        line-height: 1.4;
    }
    
    .product-actions {
        padding: 0 16px 16px;
        display: flex;
        gap: 8px;
        flex-direction: column;
    }
    
    .btn {
        padding: 12px 16px;
        border: none;
        border-radius: 4px;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-decoration: none;
        font-size: 14px;
    }
    
    .btn-add-cart {
        background: var(--accent-color);
        color: white;
        flex: 1;
    }
    
    .btn-add-cart:hover,
    .btn-add-cart:focus {
        background: #7BCA00;
        outline: none;
    }
    
    .btn-outline {
        background: transparent;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
        flex: 1;
    }
    
    .btn-outline:hover,
    .btn-outline:focus {
        background: var(--primary-color);
        color: white;
        outline: none;
    }
    
    .btn-disabled {
        background: #E5E7EB;
        color: #6B7280;
        cursor: not-allowed;
        flex: 1;
    }
    
    @media (max-width: 640px) {
        .product-name {
            font-size: 14px;
        }
        
        .product-price {
            font-size: 16px;
        }
    }
</style>
